---
layout: post
title: "Proyecto 1: Monitorización ambiental con DHT11 y LCD 16x02"
date: 2025-04-19 19:18:43 +0200
categories: arduino proyectos
excerpt: "El proyecto que presentamos consiste en la implementación de un sistema de monitorización ambiental utilizando un sensor DHT11 y una pantalla LCD 16x2."
---

[img01]: /assets/images/projects/pro01-01.png "Bus I2C"  
[img02]: /assets/images/projects/pro01-02.png "Módulo I2C LCD 1602"  
[img03]: /assets/images/projects/pro01-03.jpg "Conexiones módulo I2C LCD 1602"  
[img04]: /assets/images/material/mat_arduinouno.jpeg "Arduino UNO"  
[img05]: /assets/images/material/mat_dht11.jpeg "Sensor DHT11"  
[img06]: /assets/images/material/mat_protoboard.png "Protoboard"
[img07]: /assets/images/material/mat_LCD16x02.png "Pantalla LCD 1602"  
[img08]: /assets/images/material/mat_cables.png "Cables"  
[img09]: /assets/images/material/mat-mod-i2c-lcd.png "Módulo I2C LCD 1602"  
[img10]: /assets/images/projects/pro01-04.png "Conexiones"  
[img11]: /assets/images/projects/pro01-05.png "Protoboard"  
[img12]: /assets/images/projects/pro01-06.png "Video"  

## Finalidad

El proyecto que presentamos consiste en la implementación de un sistema de monitorización ambiental utilizando un sensor DHT11 y una pantalla LCD 16x2. El sensor DHT11 es capaz de medir la temperatura y humedad del ambiente en el que está instalado, mientras que la pantalla LCD 16x2 se utiliza para visualizar los datos obtenidos por el sensor.

Para comunicar ambos componentes, se utilizará el protocolo de comunicación I2C que permite la transmisión de datos entre dispositivos a través de dos cables: uno para la transmisión de datos (SDA) y otro para la señal de reloj (SCL).
La placa Arduino será la encargada de procesar los datos obtenidos por el sensor DHT11 y enviarlos a la pantalla LCD 16x2 a través del protocolo I2C. De esta forma, se podrá obtener información en tiempo real sobre la temperatura y la humedad del ambiente monitorado de forma clara y sencilla.

Este proyecto puede tener múltiples aplicaciones prácticas, desde la monitorización de la temperatura y humedad en un invernadero hasta el control climático en una vivienda. Además, su diseño modular y su facilidad de implementación lo hacen ideal para usuarios con diferentes niveles de experiencia en electrónica y programación.

## Introducción

Para sacar adelante este proyecto necesitamos entender primero unos pocos conceptos. Tenemos que saber cómo funciona la comunicación entre los elementos del montaje, por eso explicaremos qué es el bus I2C (un sistema de transmisión de datos por sólo dos hilos). introducción nos pondremos manos a la obra con el montaje y la programación.

### El bus I2C/TWI

I2C (I²C, del inglés Inter-Integrated Circuit) es un bus serie de datos desarrollado en 1982 por Philips Semiconductors (hoy NXP Semiconductors, parte de Qualcomm). Se utiliza principalmente internamente para la comunicación entre distintas partes de un circuito, por ejemplo, entre un controlador y circuitos periféricos integrados.
El I²C está diseñado como un bus maestro-esclavo. La transferencia de datos es siempre inicializada por un maestro; el esclavo reacciona. Una de las propiedades del I²C es que un microcontrolador puede controlar toda una red de circuitos integrados con sólo dos I/O-Pins (Input/Output) y un software muy simple.

#### Características

- Protocolo de dos hebras de control, uno para transmitir los datos, SDA, y otro, el reloj asíncrono que indica cuándo leer los datos, SCL. Más GND y 5V (cuando se requiera).
- Cada dispositivo conectado al bus I2C y cada uno tiene su dirección exclusiva, de 7 bits, (Así que, en teoría, podemos conectar 27 = 128, dispositivos).
- Uno de estos componentes, debe actuar como máster, es decir controla el reloj.
- No se requiere una velocidad de reloj estricta, puesto que es el máster quien controla el Clock.
- Es multimáster, el máster puede cambiar, pero sólo uno puede estar activo uno a la vez.

![Bus I2C][img01]

### Arduino y el bus I2C/TWI

Las placas arduino tienen predefinidos unos pinos para las funciones SDA y SCL.

- Arduino UNO, nano y mini, los pinos analógicos A4 (SDA) y A5 (SCL).
- Arduino Mega y DUE, los pinos 20 (SDA) y 21 (SCL).

Por otra parte, la librería Wire (preinstalada en el IDE de Arduino) gestiona el protocolo de comunicaciones completo.

### Módulo adaptador I2C a LCD

El Módulo adaptador LCD a I2C que vamos a usar está basado en el controlador I2C PCF8574, el cual es un Expansor de Entradas y Salidas digitales controlado por I2C. Por el diseño del PCB este módulo se usa especialmente para controlar un LCD Alfanumérico.

La dirección I2C por defecto del módulo puede ser 0x3F o en otros casos 0x27. Es muy importante identificar correctamente la dirección I2C de nuestro módulo, porque de otro modo nuestro programa no funcionará correctamente. Para identificar la dirección específica de nuestro módulo podemos utilizar un pequeño sketch de prueba llamado: Scanner, que nos permite identificar la dirección I2C del dispositivo conectado al Arduino. Para poder subirlo a una placa arduino hay que instalar la librería I2CScanner desde el «Gestor de bibliotecas» y burcarlo en «Ejemplos».

Si en caso de existir la necesidad de trabajar con más de un LCD podemos modificar la dirección I2C del módulo adaptador. Para ello es necesario soldar los puentes A0, A1 y A2 presentes en el módulo; estos tres puentes son los bits menos significativos de la dirección I2C del módulo. La dirección 0x3F en binario sería: `0 0 1 1 1 A2 A1 A0` y la dirección 0x27: `0 0 1 0 0 A2 A1 A0`. Por defecto A0, A2, A1 valen 1 pero si soldamos los puentes, éstos se conectan al suelo teniendo un valor 0. Por ejemplo si soldamos los tres puentes la nueva dirección sería `0 0 1 0 0 0 0 0` (0x20), para un chip que anteriormente era 0x27.

![Módulo I2C LCD 1602][img02]

Para controlar el contraste de los dígitos en el LCD sólo necesitamos girar el potenciómetro que se encuentra en el módulo, hasta quedar conformes con el contraste mostrado.

La luz de fondo se controla principalmente por software desde Arduino, pero el módulo también permite desconectar el Led de la luz de fondo removiendo un jumper LED.

### Conexiones entre Arduino y Módulo adaptador LCD a I2C

El adaptador LCD en I2C tiene los pines ordenados para conectar directamente al LCD, esto lo podemos hacer a través de un protoboard o soldando directamente en el LCD.

![Conexiones módulo I2C LCD 1602][img03]

Para conectar con el módulo con el Arduino sólo utilizamos los pinos I2C del Arduino (SDA y SCL) y alimentación (GND y 5V), los pinos I2C varían de acuerdo con el modelo de Arduino con el que trabajamos, en la siguiente tabla podemos ver cuáles son los pinos I2C para cada modelo de Arduino.

|Adaptador LCD a I2C|Arduino Uno, Nano, Mini.|Arduino Mega , DUE|Arduino Leonardo|
|---|---|---|---|
|GND|GND|GND|GND|
|VCC|5V|5V|5V|
|SDA|A4|20|2|
|SCL|A5|21|3|

### Bibliotecas

Para poder hacer funcionar todos los elementos necesitamos la ayuda de tres bibliotecas: Wire, LiquidCrystal_I2C, y DHT. Wire y DHT están integradas en el IDE arduino, si no lo están hay que instalarlas desde la opción Herramientas>Gestiona las bibliotecas y buscar DHT sensor library (by Adafruit).

Podemos descargar la biblioteca [LiquidCrystal_I2C](https://github.com/fdebrabander/Arduino-LiquidCrystal-I2C-library) haciendo clic sobre el nombre.

## Material

|Material|Descripción|
|---|---|
|![Arduino UNO][img04]|Placa Arduino UNO|
|![Protoboard][img06]|Placa de pruebas|
|![Cable USB][img08]|Cable USB|
|![Sensor DHT11][img05]|Sensor de temperatura y humedad|
|![Módulo adaptador LCD a I2C][img09]|Módulo adaptador LCD a I2C|
|![Pantalla LCD 1602][img07]|Pantalla LCD 1602|

## Montaje

En este caso voy a utilizar una placa Arduino nano, pero el montaje es similar si se utiliza la placa Arduino UNO, simplemente cambian de sitio los pins. La numeración o identificación es la misma.

El módulo I2C LCD puede estar o no acoplado a la pantalla. En mi caso, ambos elementos están unidos. Si los aparatos se encuentran separados habrá que fijarlos en la protoboard de forma que sus pinos queden conectados.

![Conexiones del montaje][img10]

![Montaje en Protoboard][img11]  

## Programación

``` Arduino
/*
 * CARTROTECH  (cartrotech.github.io)
 * 
 * Projecto nº: P001
 * Descripcion: Leer los datos de un sensor DHT11 i presentarlas en una pantalla LCD 16x02 mediante       
 * el modulo de comunicacion I2C
 * Codigo para la placa que recibe los datos del sensor DHT11 y gobierna el LCD 1602
 * 
 * 22.08.2021
 */

#include <Wire.h>
#include <LiquidCrystal_I2C.h>
#include <DHT.h>

#define DHTPIN 2          //Pin digital conectado al sensor DHT
#define DHTTYPE DHT11     //Tipo de sensor

DHT dht(DHTPIN, DHTTYPE);             //Declara el object0 DHT con los parametros PIN i TYPE
LiquidCrystal_I2C lcd(0x27, 16, 2);   //Crea el objecto lcd con direccion 0x27, 16 caracteres y 2 líneas


void setup() 
{
  Serial.begin(9600);  // Abre y configura monitor serie a 9600 bps
  Wire.begin();        // Unirse al bus i2c como master
  lcd.begin();         //Inicializa el objecto lcd
  lcd.backlight();
  dht.begin();         //Inicializa el objecto DHT
}

void loop() 
{
  delay(2000);  //Espera 2 seg entre medidas

  float h = dht.readHumidity();         //Lee la humedad
  float t = dht.readTemperature();      //Lee la temperatura en Celsius
  if (isnan(h) || isnan(t))             //Comprueba que no hay error
    {
      lcd.clear();
      lcd.println("Fallo llegint sensor DHT!");
      return;
    }
  float hic = dht.computeHeatIndex(t, h, false);    //Calcula el index de calor en Celsius
  tempinlcd(h, t, hic);                             //Llama a la funcion que presenta en pantalla
}

void tempinlcd(float HR, float TC, float IC)        //Funcion que controla la presentacion en pantalla
{
  char lcdTC[5];
  char lcdHR[5];
  char lcdIC[5];
  
  lcd.setCursor(0,0);
  lcd.print("T: ");
  dtostrf(TC,4,1,lcdTC);
  lcd.print(lcdTC);

  lcd.setCursor(8,0);
  lcd.print("H: ");
  dtostrf(HR,4,1,lcdHR);
  lcd.print(lcdHR);

  lcd.setCursor(0,1);
  lcd.print("IC: ");
  dtostrf(IC,4,1,lcdIC);
  lcd.print(lcdIC);
}
```

![Montaje final][img12]
